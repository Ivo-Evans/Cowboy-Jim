<!-- This works but I haven't yet built in interruptibility-->
<!--Why not just make a stupid solution, and Then a clever solution? The stupid solution would be add reloading: false
to the cylinder objects. At the start of reload(), set reloading = !reloading. At the end of insertCylinder, set
reloading = !reloading. In reload(), if reloading == true, call insertCylinder(gun), else set timeouts to callback with insertBullet and then insertCylinder. 

Good approach right? Well, the problem is, it's not bug-proof. If a timeout has been sent, and then the user
cancels, 

wait - the bug can be eliminated by ensuring that insertCylinder uses the same kind of cycle identification that
insertBullet does. If reloading == true, call insertCylinder with gun.cycle; if reloading == false, send it off 
with currentCycle and if, when it returns, currentCycle (now called oldCycle) != gun.cycle, we know that this 
reload command has expired. 
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>reloadTest</title>
  </head>
  <body>
    <p id="ammoCounter">Left: 6, Right: 6</p>
    <p>    
      <button id="shootLeft">shoot left</button>
      <button id="shootRight">shoot right</button>
    </p>
    <p>
      <button id="leftReload">reload left</button>
      <button id="rightReload">reload right</button>
    </p>


    <script>
      let leftShootButton = document.getElementById('shootLeft');
      let leftReloadButton = document.getElementById('leftReload');

      let rightShootButton = document.getElementById('shootRight');
      let rightReloadButton = document.getElementById('rightReload');

      let ammoCounter = document.getElementById('ammoCounter');
      let leftCylinder = {
        bullets: 6,
        cycle: 0,
        reloading: false
      }
      let rightCylinder = {
        bullets: 6,
        cycle: 0,
        reloading: false
        }
      rightShootButton.addEventListener('click', () => decrementAmmo(rightCylinder));
      leftShootButton.addEventListener('click', () => decrementAmmo(leftCylinder));
      rightReloadButton.addEventListener('click', () => reload(rightCylinder));
      leftReloadButton.addEventListener('click', () => reload(leftCylinder));
      
      function decrementAmmo(gun) {
        gun.bullets--;
        ammoCounter.innerText = "Left: " + leftCylinder.bullets + ", Right: " + rightCylinder.bullets;
      }

      function reload(gun) {
        if (gun.bullets < 6) {
          console.log(gun.cycle);
          gun.cycle++;

          let currentCycle = [gun.cycle][0];
          if (gun.reloading) {
            setTimeout(() => insertCylinder(gun, currentCycle), 500);
            // insertCylinder(gun, currentCycle);
          } else {
            gun.reloading = !gun.reloading;
            for(let i = 1; i < 7 - gun.bullets; i++) {
              setTimeout(() => insertBullet(gun, currentCycle), i * 500);
            }
            setTimeout(() => insertCylinder(gun, currentCycle), (8 - gun.bullets) * 500);
          }
        }
      }

      // function reload(gun) {
      //   gun.cycle++;
      //   let currentCycle = [gun.cycle][0]; // make copy of current cycle to send into future
      //   if (gun.bullets < 6) { // given the way reload is called, this conditional might be unnecessary. Or you could change the way it is called and put the lines above this conditional in this function inside it.
      //     for(let i = 1; i < 7 - gun.bullets; i++) {
      //       setTimeout(() => insertBullet(gun, currentCycle), i * 600);
      //     }
      //   }
      // }

      function insertBullet(gun, oldCycle) {
        let currentCycle = gun.cycle;
        // console.log(currentCycle == oldCycle);
        if (currentCycle == oldCycle) {
          gun.bullets++;
          ammoCounter.innerText = "Left: " + leftCylinder.bullets + ", Right: " + rightCylinder.bullets;
          let insert = new Audio('./insert-bullet.mp3');
          insert.volume = 0.4;
          insert.play();

        };
      }

      function insertCylinder(gun, oldCycle) {

        if(gun.cycle == oldCycle) {
          gun.reloading = !gun.reloading;
          let insert = new Audio('./insert-cylinder.mp3');
          insert.volume = 0.4;
          insert.play();
        }
      }
    </script>
  </body>
</html>
